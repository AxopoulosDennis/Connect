@using Connect.Models
@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Community.Contentment.DataEditors
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage;
@{
    Layout = "";
    ProductModel product = ViewBag.Item;
}
@if (product != null)
{

        <input type="hidden" name="PageId" value="@product.PageId" />
        <input type="hidden" name="SectionKey" value="@product.SectionKey" />
        <input type="hidden" name="ProductKey" value="@product.ProductKey" />

        @if (product.Ingredients?.Any() ?? false)
        {
            var counter = 0;

            var ingredientsCounter = 0;
            var maxIngredients = 3;

            <input type="hidden" id="maxIngredients" value="@maxIngredients" />

            <div class="ingridients__container">
                <div class="product_cart_item list-group list-group-light">

                    <div class="shrinked_ingridients" id="shrinkedIngridients" data-bs-toggle="modal" data-bs-target="#expandIngredients" onclick="modalMemory(this)">
                        <div class="top">
                            <span class="title">Υλικά</span>
                            <i class="fa fa-edit"></i>
                        </div>

                        <div class="ingridients top__margin">

                            @foreach (var ingridient in product.Ingredients)
                            {
                                if (ingredientsCounter < maxIngredients)
                                {
                                    if (ingridient == product.Ingredients.Last())
                                    {
                                        <span class="ingridient">@ingridient.IngredientName</span>

                                    }
                                    else
                                    {
                                        <span class="ingridient">@(ingridient.IngredientName + ",")</span>

                                    }

                                    ingredientsCounter++;
                                }
                                else
                                {
                                    var total = product.Ingredients.Count() - maxIngredients;

                                    if (total > 0)
                                    {
                                        <span class="ingridient">+@(total)</span>

                                    }
                                    else
                                    {
                                        <span class="ingridient">@ingridient.IngredientName</span>

                                    }

                                    break;
                                }


                            }
                        </div>
                    </div>

                    <div class="modal fade" id="expandIngredients" aria-hidden="true" tabindex="-1" aria-labelledby="expandIngredientsLabel" data-bs-backdrop="static" data-bs-keyboard="false">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title" id="expandIngredientsLabel">
                                        @(Umbraco.GetDictionaryValue("EditIngredients", "Επιλέξτε Υλικά"))
                                    </h1>
                                    <button data-type="#expandIngredients" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="resetMemory(this)"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="wrapper__ingredients">

                                        <div class="ingredients__container">
                                            @{
                                                var inCount = 0;
                                            }

                                            @for (var index = 0; index < product.Ingredients.Count(); index++)
                                            {
                                                var name = product.Ingredients[index].IngredientName + "_" + index;

                                            <div class="form-check">


                                                <input data-name="@product.Ingredients[index].IngredientName" class="form-check-input" type="checkbox" asp-for="@product.Ingredients[index].IsIngredientSelected" class="form-check-input" />
                                                <label class="form-check-label" asp-for="@product.Ingredients[index].IsIngredientSelected">
                                                    <span class="product__name">@product.Ingredients[index].IngredientName</span>
                                                </label>
                                            </div>

                                            }
                                        </div>

                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button data-type="#expandIngredients" onclick="saveOption(this)" type="button" id="acceptIngredients" data-bs-dismiss="modal" class="btn btn-primary">@(Umbraco.GetDictionaryValue("Save", "Αποθήκευση"))</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        if(product.Extras?.Any() ?? false)
        {
        <div class="ingridients__container">

            <div class="product_cart_item list-group list-group-light">

                <div onclick="modalMemory(this)" class="shrinked_ingridients" id="addExtraIngredients" data-bs-toggle="modal" data-bs-target="#expandAddExtra">
                    <div class="top">
                        <span class="title">Προσθέστε Extra</span>
                        <i class="fa fa-edit"></i>
                    </div>

                    <div class="ingridients">
                    </div>
                </div>

                <div class="modal fade" id="expandAddExtra" aria-hidden="true" tabindex="-1" aria-labelledby="expandAddExtraLabel">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title" id="expandAddExtraLabel">
                                    @(Umbraco.GetDictionaryValue("AddIngredients", "Προσθέστε Extra"))
                                </h1>
                                <button data-type="#expandAddExtra" onclick="resetMemory(this)" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="wrapper__ingredients">

                                    <div class="ingredients__container">
                                        @{
                                            var inCount = 0;
                                        }

                                        @for (var index = 0; index < product.Extras.Count(); index++)
                                        {
                                            var extraName = product.Extras[index].ExtraName;
                                            var extraCost = product.Extras[index].ExtraPrice;
                                            var isSelected = product.Extras[index].IsExtraSelected;

                                            <div class="form-check  extra__product">

                                                <input data-name="@extraName" data-price="@extraCost" class="form-check-input" type="checkbox" asp-for="@product.Extras[index].IsExtraSelected" class="form-check-input" />
                                                <label class="form-check-label" asp-for="@product.Extras[index].IsExtraSelected">
                                                    <span class="product__name">@extraName</span>
                                                    <span class="product__cost">+@extraCost.ToString("F2")&#8364</span>
                                                </label>


                                            </div>
                                        }

                                        @*                                         @foreach (var item in product.Extras)
                                    {
                                    inCount++;
                                    var extraName = item.ExtraName;
                                    var extraCost = item.ExtraPrice;


                                    <div class="form-check extra__product">

                                    @Html.CheckBoxFor(p => item.IsExtraSelected, new { @class = "form-check-input" })
                                    @Html.LabelFor(p => item.IsExtraSelected, item.ExtraName, new { @class = "form-check-label" })

                                    <input class="form-check-input" type="checkbox" value="" id="@(extraName + "_" + inCount)">

                                    <label class="form-check-label" for="@(extraName + "_" + inCount)">
                                    <span class="product__name">@extraName</span>
                                    <span class="product__cost">+@extraCost.ToString("F2")&#8364</span>
                                    </label>

                                    </div>


                                    } *@
                                    </div>

                                </div>

                            </div>
                            <div class="modal-footer">
                                <button data-type="#expandAddExtra" onclick="saveOption(this)" type="button" id="acceptIngredients" data-bs-dismiss="modal" class="btn btn-primary">@(Umbraco.GetDictionaryValue("Done", "Done"))</button>
                            </div>
                        </div>
                    </div>
                </div>




            </div>
        </div>
        }

        <div class="ingridients__container">

            <div class="product_cart_item list-group list-group-light">

                <div onclick="modalMemory(this)" class="shrinked_ingridients" id="addComments" data-bs-toggle="modal" data-bs-target="#expandComments">
                    <div class="top">
                        <span class="title">Σχόλια</span>
                        <i class="fa fa-edit"></i>
                    </div>

                    <div class="ingridients">
                    </div>
                </div>

                <div class="modal fade" id="expandComments" aria-hidden="true" tabindex="-1" aria-labelledby="expandCommentsLabel">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title" id="expandCommentsLabel">
                                    @(Umbraco.GetDictionaryValue("Comments", "Σχόλια"))
                                </h1>
                                <button data-type="#expandComments" onclick="resetMemory(this)" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="wrapper__ingredients">

                                    <div class="comments__container form-group">
                                        <textarea asp-for="@product.Comments" maxlength="50" class="form-control" id="commentsArea" rows="3"></textarea>
                                    </div>

                                </div>

                            </div>
                            <div class="modal-footer">
                                <button data-type="#expandComments" onclick="saveOption(this)" type="button" id="acceptIngredients" data-bs-dismiss="modal" class="btn btn-primary">@(Umbraco.GetDictionaryValue("Done", "Done"))</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="add__container">

            <div class="qty-container">
                <button onclick="buttonMinus(this)" class="qty-btn-minus btn-light" type="button"><i class="fa fa-minus"></i></button>
                <input name="QuantityInBasket" type="number" name="qty" value="@product.QuantityInBasket" class="input-qty" oninput="checkQuantity(this);" />

                <button onclick="buttonPlus(this)" class="qty-btn-plus btn-light" type="button"><i class="fa fa-plus"></i></button>
            </div>
            <button class="add_basket_button_container" type="sumbit" value="sumbit">


                <div class="add_basket_button">Add to order@* <i class="fa fa-plus-circle"></i> *@</div>
                <div class="total__product__price">
                    @product.FinalPrice.ToString("F2")&#8364
                </div>
            </button>
        </div>


}





