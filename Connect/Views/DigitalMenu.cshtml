@using Connect.Models;
@using Umbraco.Cms.Core.Models;
@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage;
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@using Umbraco.Cms.Core.Models.Blocks;
@{
    var type = Model.ContentType.Alias ?? "";
    switch (type)
    {
        case "digitalMenu":
            Layout = "Layouts/DigitalMenu";
            break;
        default:
            Layout = "";
            break;
    }

    var coverPhotoUrl = Model?.Value<IPublishedContent>("coverPhoto")?.MediaUrl() ?? "";
    var socialMedia = Model?.Value<IEnumerable<SocialLink>>("socialNetworks");
    var profilePhotoUrl = Model?.Value<IPublishedContent>("profilePhoto")?.MediaUrl() ?? "";
    var brandName = Model?.Value<string>("brandName") ?? "";
    var promoText = Model?.Value<string>("promotionalText") ?? "";
    var hideShareButton = Model?.Value<bool>("hideSocialShare") ?? false;
    var triggerColor = Model?.Value("aboutTriggerColor") ?? "ffffff";
    var menuSections = Model?.Value<IEnumerable<BlockListItem>>("menuSection");
    if (menuSections?.Any() ?? false)
    {
        menuSections = menuSections.Where(x => !x.Content.Value<bool>("hide"));
    }


    List<string> foodFilters = new();
    DrinkFilters drinkFilters = new();


}


<div class="page-content">

    <div class="menu-navigation-bg-abs" id="absMenuNav">
        <div class="top-container">
            <span class="hint">Select multiple categories to filter</span>
            <span class="select-all" id="selectAll" data-selected="false">Select All</span>
        </div>

        <!-- ABSOLUTE NAVIGATION -->
        <div class="menu-navigation-container">

            @if (menuSections?.Where(x => x.Content.Value<bool>("hide") == false)?.Any() ?? false)
            {
                <nav class="nav swiper mySwiper3">
                    <ul class="navigation-list swiper-wrapper">

                        @foreach (var section in menuSections.Where(x => x.Content.Value<bool>("hide") == false))
                        {
                            var sectionName = section.Content.Value<string>("sectionName") ?? "";
                            var subSections = section.Content.Value<IEnumerable<BlockListItem>>("subSections");

                            if (subSections?.Any() ?? false)
                            {
                                foreach (var subSection in subSections)
                                {

                                }
                              
                            }

                            <li class="select-cat swiper-slide">
                                <span class="cat-item">
                                    @sectionName
                                </span>
                            </li>

                        }
                    </ul>
                </nav>
            }

        </div>
        
               
    </div>


    <div class="inner-content">
        
        <!-- COVER IMAGE AND BRAND IMAGE -->
        
        <section class="top-cover">
            <div class="cover-container">
                <div class="cover-image-container">
                    @if (!string.IsNullOrEmpty(coverPhotoUrl))
                    {
                        <img class="cover-image" src="@coverPhotoUrl">
                    }

                </div>

                @if (!string.IsNullOrEmpty(profilePhotoUrl))
                {
                    <div class="brand-image-container">
                        <img class="brand-image" src="@profilePhotoUrl">
                    </div>
                }
            </div>
        </section>
        <section class="content-container">

            <!-- SOCIAL MEDIA -->

            <div class="brand-info-container">
                <div class="social-container">
                    @if (socialMedia?.Any() ?? false)
                    {
                        foreach (var social in socialMedia)
                        {
                            var name = social?.Name?.ToLower() ?? "";
                            var socialLink = social?.Url ?? "#";

                            if (socialLink != null)
                            {
                                var imageSrc = "";                            

                                if (name == "facebook")
                                {
                                    imageSrc = "/images/_3dtheme/light/social/facebook_social.png";
                                }
                                else if (name == "instagram")
                                {
                                    imageSrc = "/images/_3dtheme/light/social/instagram_social.png";

                                }
                                else if (name == "tiktok")
                                {
                                    imageSrc = "/images/_3dtheme/light/social/tiktok_social.png";
                                }

                                <a href="@socialLink" target="_blank"><img class="social-icon" src="@imageSrc"></a>

                            }

                        }
                    }
                    @if (!hideShareButton)
                    {
                        <a href="#"><img class="social-icon" src="/images/_3dtheme/light/social/share_social.png" /></a>
                    }
                </div>

                <!-- BRAND NAME AND PROMO TEXT -->

                <span class="brand-name">
                    @brandName
                </span>
                <span class="promo-text">
                    @promoText
                </span>
            </div>

            <!-- MENU NAVIGATION -->

            <div class="menu-navigation-bg sticky" id="menuNav">
                <div class="menu-navigation-container">
                    @if (menuSections?.Any() ?? false)
                    {
                        var counter = 0;

                        <nav class="nav swiper mySwiper">
                            <ul class="navigation-list swiper-wrapper">

                                @foreach (var section in menuSections)
                                {
                                    counter++;
                                    var sectionName = section.Content.Value<string>("sectionName") ?? "";

                                    if (section == menuSections.First())
                                    {
                                        <li class="nav-item swiper-slide">
                                            <a href="#" data-link="#category_@counter" class="nav-link active">@sectionName</a>
                                        </li>
                                    }
                                    else
                                    {
                                        <li class="nav-item swiper-slide">
                                            <a href="#" data-link="#category_@counter" class="nav-link">@sectionName</a>
                                        </li>
                                    }
                                }

                            </ul>
                        </nav>
                    }
                </div>
            </div>

            <!-- MENU CONTENT -->

            <div class="menu-container">
                @if (menuSections?.Any() ?? false)
                {
                    var counter = 0;

                    @foreach (var section in menuSections.Where(x=> x.Content.Value<bool>("hide") == false))
                    {
                        counter++;

                        var subSections = section.Content.Value<IEnumerable<BlockListItem>>("subSections");
                        var catName = section.Content.Value<string>("groupName") ?? "";
                        var catIcon = section.Content.Value<IPublishedContent>("groupIcon")?.MediaUrl() ?? "";

                        if (subSections?.Any() ?? false)
                        {
                            var firstItemCounter = 0;

                            <div class="category" id="category_@counter">
                                <div class="heading-icon-container">
                                    @if (!string.IsNullOrEmpty(catIcon))
                                    {
                                        <image class="heading-icon" src="@catIcon"></image>
                                    }
                                    <h2 class="heading">@catName</h2>
                                </div>

                                @foreach (var subSection in subSections.Where(x=> x.Content.Value<bool>("hide") == false))
                                {
                                    firstItemCounter++;
                                    var sectionItems = subSection.Content.Value<IEnumerable<BlockListItem>>("sectionItems");

                                    if (sectionItems?.Any() ?? false)
                                    {
                                        bool hideName = subSection.Content.Value<bool>("hideName");

                                        if(!hideName)
                                        {
                                            var subSectionName = subSection.Content.Value<string>("subSectionName") ?? "";

                                            var borderClass = "";
                                            if (firstItemCounter == 1)
                                            {
                                                borderClass = "no-top-border";
                                            }

                                            <div class="sub-cat-name-container @borderClass">
                                                <div class="border-container">
                                                    <h2 class="heading">@subSectionName</h2>

                                                </div>
                                            </div>

                                        }


                                        <div class="products-container">

                                            @foreach (var product in sectionItems)
                                            {
                                                var productName = product.Content.Value<string>("itemName") ?? "";
                                                var productDesc = product.Content.Value<string>("itemDescription") ?? "";
                                                var productPhotos = product.Content.Value<IEnumerable<IPublishedContent>>("itemPhotos");
                                                var alias = product.Content.ContentType.Alias;
                                                var servedIn = product.Content.Value<string>("servedIn") ?? "";
                                                decimal originalPrice = product.Content.Value<decimal>("originalPrice");
                                                string discountType = product.Content.Value<string> ("discountType") ?? "";
                                                bool hasVariations = false;
                                                @if (alias == "beerBeverage")
                                                {
                                                   if(product?.Content?.Value<IEnumerable<BlockListItem>>("beerVariations")?.Any() ?? false)
                                                   {
                                                        hasVariations = true;
                                                   }

                                                }
                                                if(hasVariations == false)
                                                {
                                                    <div class="product">
                                                        <div class="text-photo-container">
                                                            <div class="product-text">
                                                                <h3>@productName</h3>
                                                                <p>@productDesc</p>


                                                                @if (!string.IsNullOrEmpty(discountType) && discountType != "Hide")
                                                                {
                                                                    decimal discountAmount = product.Content.Value<decimal>("discountAmount");

                                                                    decimal finalPrice = originalPrice;

                                                                    if (discountType == "Final Price")
                                                                    {
                                                                        finalPrice = discountAmount;
                                                                    }
                                                                    else if (discountType == "Fixed Price")
                                                                    {
                                                                        finalPrice = originalPrice - discountAmount;

                                                                    }
                                                                    else if (discountType == "Percentage")
                                                                    {
                                                                        var discountPercentage = (discountAmount / 100) * (originalPrice / 1);
                                                                        finalPrice = Math.Ceiling((finalPrice - discountPercentage) * 20) / 20;

                                                                    }

                                                                    <p class="final-price has-discount">@finalPrice.ToString("F2")&#8364<span class="original-price">@originalPrice.ToString("F2")&#8364</span></p>

                                                                }
                                                                else
                                                                {
                                                                    <p class="final-price">@originalPrice.ToString("F2")&#8364<span class="original-price"></span></p>

                                                                }

                                                            </div>
                                                            @if (productPhotos?.Any() ?? false)
                                                            {
                                                                var mainPhoto = productPhotos?.FirstOrDefault()?.MediaUrl() ?? "";

                                                                <div class="product-photo-container">
                                                                    <img src="@mainPhoto" class="product-photo">
                                                                </div>
                                                            }

                                                        </div>

                                                        @if (alias == "beerBeverage")
                                                        {
                                                            decimal? alc = product.Content.Value<decimal>("alcohol");
                                                            int? ibu = product.Content.Value<int>("internationalBitternessUnits");
                                                            int? ml = product.Content.Value<int>("millilitre");

                                                            <div class="tags-container" data-filters-type="beer">

                                                                <span class="tag" data-abv="@alc">
                                                                    @alc% ABV
                                                                </span>
                                                                <span class="tag" data-ibu="@ibu">
                                                                    @ibu IBU
                                                                </span>
                                                                <span class="tag" data-serverd-in="@servedIn">
                                                                    @if (servedIn == "Bottle")
                                                                    {
                                                                        <img src="/images/_3DTheme/Light/FoodTags/bottle-beer.png" style="height:20px;width:20px;" />
                                                                    }
                                                                    else if (servedIn == "Draft")
                                                                    {
                                                                        <img src="/images/_3DTheme/Light/FoodTags/draft-beer.png" style="height:16px; " />
                                                                    }
                                                                </span>

                                                            </div>
                                                        }
                                                    </div>

                                                }
                                                else
                                                {
                                                    IEnumerable<BlockListItem> variations = null;


                                                    <div class="product">
                                                        <div class="text-photo-container">
                                                            <div class="product-text">
                                                                <h3>@productName</h3>
                                                                @if(!string.IsNullOrEmpty(productDesc))
                                                                {
                                                                    <p>@productDesc</p>
                                                                }

                                                                <div class="swiper-container tabs-buttons">
                                                                    <div class="swiper-wrapper">
                                                                        @if(alias == "beerBeverage")
                                                                        {
                                                                            decimal? alc = product.Content.Value<decimal>("alcohol");
                                                                            int? ibu = product.Content.Value<int>("internationalBitternessUnits");
                                                                            int? mainMl = product.Content.Value<int>("millilitre");
                                                                            variations = product?.Content?.Value<IEnumerable<BlockListItem>>("beerVariations");

                                                                            <div class="swiper-slide active-tab">@mainMl ml</div>

                                                                            @foreach (var item in variations)
                                                                            {
                                                                                var ml = item.Content.Value<decimal>("millilitre");
                                                                                <div class="swiper-slide">@ml ml</div>
                                                                            }

                                                                        }

  
                                                                    </div>
                                                                    <!--   <div class="swiper-scrollbar"></div> -->
                                                                </div>

                                                                <div class="swiper-container tabs-content">
                                                                    <div class="swiper-wrapper">

                                                                        @if(alias == "beerBeverage")
                                                                        {
                                                                            <div class="swiper-slide">
                                                                                @if (!string.IsNullOrEmpty(discountType) && discountType != "Hide")
                                                                                {
                                                                                    decimal discountAmount = product.Content.Value<decimal>("discountAmount");
                                                                                    decimal finalPrice = originalPrice;

                                                                                    if (discountType == "Final Price")
                                                                                    {
                                                                                        finalPrice = discountAmount;
                                                                                    }
                                                                                    else if (discountType == "Fixed Price")
                                                                                    {
                                                                                        finalPrice = originalPrice - discountAmount;

                                                                                    }
                                                                                    else if (discountType == "Percentage")
                                                                                    {
                                                                                        var discountPercentage = (discountAmount / 100) * (originalPrice / 1);
                                                                                        finalPrice = Math.Ceiling((finalPrice - discountPercentage) * 20) / 20;

                                                                                    }


                                                                                    <p class="final-price has-discount">@finalPrice.ToString("F2")&#8364<span class="original-price">@originalPrice.ToString("F2")&#8364</span></p>

                                                                                }
                                                                                else
                                                                                {
                                                                                    <p class="final-price">@originalPrice.ToString("F2")&#8364<span class="original-price"></span></p>

                                                                                }
                                                                            </div>

                                                                            @foreach (var item in variations)
                                                                            {
                                                                                decimal variationOriginalPrice = item.Content.Value<decimal>("originalPrice");
                                                                                string variationDiscountType = item.Content.Value<string>("discountType") ?? "";

                                                                                @if (!string.IsNullOrEmpty(discountType) && discountType != "Hide")
                                                                                {
                                                                                    decimal vDiscountAmount = item.Content.Value<decimal>("discountAmount");

                                                                                    decimal vFinalPrice = variationOriginalPrice;

                                                                                    if (discountType == "Final Price")
                                                                                    {
                                                                                        vFinalPrice = vDiscountAmount;
                                                                                    }
                                                                                    else if (discountType == "Fixed Price")
                                                                                    {
                                                                                        vFinalPrice = variationOriginalPrice - vDiscountAmount;

                                                                                    }
                                                                                    else if (discountType == "Percentage")
                                                                                    {
                                                                                        var discountPercentage = (vDiscountAmount / 100) * (originalPrice / 1);
                                                                                        vFinalPrice = Math.Ceiling((vFinalPrice - discountPercentage) * 20) / 20;

                                                                                    }

                                                                                    <div class="swiper-slide">
                                                                                        <p class="final-price has-discount">@vFinalPrice.ToString("F2")&#8364<span class="original-price">@originalPrice.ToString("F2")&#8364</span></p>
                                                                                    </div>


                                                                                }
                                                                                else
                                                                                {
                                                                                    <div class="swiper-slide">
                                                                                        <p class="final-price">@variationOriginalPrice.ToString("F2")&#8364<span class="original-price"></span></p>
                                                                                    </div>
                                                                                }


                                                                            }

                                                                        }

                                                                    </div>
                                                                </div>

                                                            </div>
                                                            @if (productPhotos?.Any() ?? false)
                                                            {
                                                                var mainPhoto = productPhotos?.FirstOrDefault()?.MediaUrl() ?? "";

                                                                <div class="product-photo-container">
                                                                    <img src="@mainPhoto" class="product-photo">
                                                                </div>
                                                            }

                                                        </div>

                                                        @if (alias == "beerBeverage")
                                                        {
                                                            decimal? alc = product.Content.Value<decimal>("alcohol");
                                                            int? ibu = product.Content.Value<int>("internationalBitternessUnits");
                                                            int? ml = product.Content.Value<int>("millilitre");

                                                            <div class="tags-container" data-filters-type="beer">

                                                                <span class="tag" data-abv="@alc">
                                                                    @alc% ABV
                                                                </span>
                                                                <span class="tag" data-ibu="@ibu">
                                                                    @ibu IBU
                                                                </span>
                                                                <span class="tag" data-serverd-in="@servedIn">
                                                                    @if (servedIn == "Bottle")
                                                                    {
                                                                        <img src="/images/_3DTheme/Light/FoodTags/bottle-beer.png" style="height:20px;width:20px;" />
                                                                    }
                                                                    else if (servedIn == "Draft")
                                                                    {
                                                                        <img src="/images/_3DTheme/Light/FoodTags/draft-beer.png" style="height:16px; " />
                                                                    }
                                                                </span>

                                                            </div>
                                                        }
                                                    </div>

                                                }
                                            }

                                        </div>
                                }

                            }

                            </div>

                        }

                    }
                }
            </div>
        </section>

        <!-- SEARCH TRIGGER -->

        <div class="bottom-search-bg" id="bottomSearch">
            <div class="bottom-search-container">
                <div class="search-row">
                    <div class="row-inner">
                        <div class="container">
                            <div class="search-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#657789" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></svg>
                            </div>
                            <div class="input-container">
                                <input id="searchInput" placeholder="Search..." />
                            </div>

                            <div class="close-icon-container" id="closeFullScreen">
                                <i class="fa fa-close close-icon"></i>

                            </div>

                        </div>
                    </div>
                </div>

                <div id="whiteSpaceLove" style="height:1px;"></div>

            </div>


            <div class="search-page-container">

                <div class="clear-filters-container">
                    <span>Clear Filters</span>
                </div>

                <div class="scrollable-content">

                    @if (foodFilters?.Any() ?? false)
                    {
                        <div class="filters-container">

                            <div class="filters-checks-container">
                                <h3>Food Filters</h3>

                                <div class="filter-checks">
                                    <nav class="nav swiper mySwiper2">
                                        <ul class="navigation-list swiper-wrapper">

                                            <li class="nav-filter swiper-slide" id="noCategorySelected">
                                                <span class="nav-item" id="noCategorySelectedItem">No category is selected</span>
                                            </li>

@*                                             @foreach (var filter in foodFilters)
                                            {
                                                <li class="nav-filter swiper-slide">
                                                    <span class="nav-item">@filter</span>
                                                </li>
                                            } *@

                                        </ul>
                                    </nav>

                                </div>

                            </div>

                        </div>

                    }

                    @if (drinkFilters != null &&
                    ((drinkFilters.Alcohol?.Any() ?? false)
                    || (drinkFilters.IBU?.Any() ?? false)
                    || (drinkFilters.ML?.Any() ?? false)
                    || (drinkFilters.ServedIn?.Any() ?? false)
                    || (drinkFilters.Spiciness?.Any() ?? false)
                    || (drinkFilters.Vintage?.Any() ?? false)
                    || (drinkFilters.Countries?.Any() ?? false)))
                    {
                        <div class="drink-filters-container">
                            <div class="drink-filters-inner-container">

                                <h3>Drinks Filters</h3>

                                <div class="drink-filters">

                                    @if (drinkFilters?.Alcohol?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">Alcohol by volume</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.Alcohol)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter%</span>
                                                    </li>
                                                }
                                            </ul>
                                        </div>


                                    }


                                    @if (drinkFilters?.IBU?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">International bitterness units</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.IBU)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter IBU</span>
                                                    </li>
                                                }

                                            </ul>

                                        </div>

                                    }


                                    @if (drinkFilters?.ML?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">Milliliters</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.ML)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter ml</span>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    }


                                    @if (drinkFilters?.ServedIn?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">Served as</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.ServedIn)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter</span>
                                                    </li>
                                                }
                                            </ul>

                                        </div>

                                    }


                                    @if (drinkFilters?.Spiciness?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">Spiciness</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.Spiciness)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter</span>
                                                    </li>
                                                }
                                            </ul>

                                        </div>
                                    }


                                    @if (drinkFilters?.Vintage?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">
                                            <span class="filters-title">Vintage</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.Vintage)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter</span>
                                                    </li>
                                                }
                                            </ul>

                                        </div>
                                    }



                                    @if (drinkFilters?.Countries?.Any() ?? false)
                                    {
                                        <div class="filter-title-content">

                                            <span class="filters-title">Origin</span>

                                            <ul class="navigation-list">

                                                @foreach (var filter in drinkFilters.Countries)
                                                {
                                                    <li class="nav-filter swiper-slide">
                                                        <span class="nav-item">@filter</span>
                                                    </li>
                                                }
                                            </ul>

                                        </div>

                                    }
                                </div>

                            </div>

                        </div>

                    }
                </div>


                <div class="search-results-container">
                    @*                        <div class="filter-sorts">
                    <nav class="nav swiper mySwiper3">
                    <ul class="navigation-list swiper-wrapper">

                    <li class="nav-filter swiper-slide">
                    <span class="nav-item">Vegan</span>
                    </li>
                    <li class="nav-filter swiper-slide">
                    <span class="nav-item">Vegeterian</span>
                    </li>
                    <li class="nav-filter swiper-slide">
                    <span class="nav-item">Spicy</span>
                    </li>
                    <li class="nav-filter swiper-slide">
                    <span class="nav-item">Lactose free</span>
                    </li>
                    <li class="nav-filter swiper-slide">
                    <span class="nav-item">Vegan</span>
                    </li>

                    </ul>
                    </nav>

                    </div>

                    <div class="sort-icon-container">
                    <div class="sort-icon">
                    <span class="sort-1"></span>
                    <span class="sort-2"></span>
                    <span class="sort-3"></span>
                    </div>
                    </div> *@

                    <div class="search-results-inner-container">
                        <div class="loader-contaniner">
                            <span class="loader"></span>
                        </div>

                        <div class="final-results-container">
                        </div>
                    </div>


                </div>

                <div class="show-results-container">
                    <div class="show-results-inner-container">
                        <span class="results-button">
                            Show me results
                        </span>
                    </div>

                </div>
            </div>
        </div>

    </div>
 
</div>
